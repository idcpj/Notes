[TOC]

> [参考网址](https://www.jianshu.com/p/b0cf461451fb)
## 前期工作(备份数据库到从数据库中)
### 锁定数据库
```
mysql>use db;
mysql>flush tables with read lock;  
```

### 导出数据
```
mysql> mysqldump -uroot -pxxxx db > db.sql;
```
### 解锁主服务器数据库
```
mysql > unlock tables;
```
### 导入从数据库
```
mysql>create database db;
mysql>use db;
mysql>source db.sql;
```

## 主服务器配置
### 修改`my.cnf`
`vi /etc/my.cnf`

```
[mysqld]

#主数据库端ID号
server_id = 1           
 #开启二进制日志                  
log-bin = mysql-bin    
#需要复制的数据库名，如果复制多个数据库，重复设置这个选项即可                  
binlog-do-db = db        
#将从服务器从主服务器收到的更新记入到从服务器自己的二进制日志文件中                 
log-slave-updates                        
#控制binlog的写入频率。每执行多少次事务写入一次(这个参数性能消耗很大，但可减小MySQL崩溃造成的损失) 
sync_binlog = 1                    
#这个参数一般用在主主同步中，用来错开自增值, 防止键值冲突
auto_increment_offset = 1           
#这个参数一般用在主主同步中，用来错开自增值, 防止键值冲突
auto_increment_increment = 1            
#二进制日志自动删除的天数，默认值为0,表示“没有自动删除”，启动时和二进制日志循环时可能删除  
expire_logs_days = 7                    
#将函数复制到slave  
log_bin_trust_function_creators = 1
```
### 重启MySQL，创建允许从服务器同步数据的账户
```
### 创建slave账号account，密码123456
mysql>grant replication slave on *.* to 'account'@'10.10.20.116' identified by '123456';
### 更新数据库权限
mysql>flush privileges;
```

### 查看主服务器状态
```
mysql>show master status\G;
***************** 1. row ****************
            File: mysql-bin.000033 #当前记录的日志
        Position: 337523 #日志中记录的位置  
    Binlog_Do_DB: 
Binlog_Ignore_DB:
```

## 从服务器配置
```



